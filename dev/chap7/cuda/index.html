<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>CUDA programming · Scientific Computing For Physicists</title><meta name="title" content="CUDA programming · Scientific Computing For Physicists"/><meta property="og:title" content="CUDA programming · Scientific Computing For Physicists"/><meta property="twitter:title" content="CUDA programming · Scientific Computing For Physicists"/><meta name="description" content="Documentation for Scientific Computing For Physicists."/><meta property="og:description" content="Documentation for Scientific Computing For Physicists."/><meta property="twitter:description" content="Documentation for Scientific Computing For Physicists."/><meta property="og:url" content="https://book.jinguo-group.science/chap7/cuda/"/><meta property="twitter:url" content="https://book.jinguo-group.science/chap7/cuda/"/><link rel="canonical" href="https://book.jinguo-group.science/chap7/cuda/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Scientific Computing For Physicists</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Become an Open-source Developer</span><ul><li><a class="tocitem" href="../../chap1/terminal/">Get a Terminal!</a></li><li><a class="tocitem" href="../../chap1/git/">Maintainability - Version Control</a></li><li><a class="tocitem" href="../../chap1/ci/">Correctness - Unit Tests</a></li></ul></li><li><span class="tocitem">Julia Programming Language</span><ul><li><a class="tocitem" href="../../chap2/julia-setup/">Setup Julia</a></li><li><a class="tocitem" href="../../chap2/julia-why/">Why Julia?</a></li><li><a class="tocitem" href="../../chap2/julia-type/">Types and Multiple-dispatch</a></li><li><a class="tocitem" href="../../chap2/julia-array/">Array and Broadcasting</a></li><li><a class="tocitem" href="../../chap2/julia-release/">My First Package</a></li><li><a class="tocitem" href="../../chap2/julia-fluid/">Project: Fluid dynamics</a></li></ul></li><li><span class="tocitem">Linear Algebra</span><ul><li><a class="tocitem" href="../../chap3/linalg/">Matrix Computation</a></li><li><a class="tocitem" href="../../chap3/linalg-impl/">Matrix Computation (Implementation)</a></li><li><a class="tocitem" href="../../chap3/fft/">Fast Fourier transform</a></li><li><a class="tocitem" href="../../chap3/sensitivity/">Sensitivity Analysis</a></li><li><a class="tocitem" href="../../chap3/sparse/">Sparse Matrices and Graphs</a></li></ul></li><li><span class="tocitem">Tensors and Tensor Networks</span><ul><li><a class="tocitem" href="../../chap3/tensors/">Tensor Operations</a></li></ul></li><li><span class="tocitem">Optimization</span><ul><li><a class="tocitem" href="../../chap4/optimization/">Optimization</a></li><li><a class="tocitem" href="../../chap4/ad/">Automatic Differentiation</a></li><li><a class="tocitem" href="../../chap5/complexity/">Computational complexity (WIP)</a></li></ul></li><li><span class="tocitem">Randomness</span><ul><li><a class="tocitem" href="../../chap5/montecarlo/">Markov Chain Monte Carlo</a></li></ul></li><li><span class="tocitem">Appendix</span><ul><li><a class="tocitem" href="../../append/plotting/">Plotting recipes with CairoMakie</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>CUDA programming</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>CUDA programming</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/GiggleLiu/ScientificComputingForPhysicists" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/GiggleLiu/ScientificComputingForPhysicists/blob/main/docs/src/chap7/cuda.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="CUDA-programming"><a class="docs-heading-anchor" href="#CUDA-programming">CUDA programming</a><a id="CUDA-programming-1"></a><a class="docs-heading-anchor-permalink" href="#CUDA-programming" title="Permalink"></a></h1><p>using Test using CUDA; CUDA.allowscalar(false) using BenchmarkTools</p><h1 id="Simulting-lattice-gas-cellular-automata&quot;"><a class="docs-heading-anchor" href="#Simulting-lattice-gas-cellular-automata&quot;">Simulting lattice gas cellular automata&quot;</a><a id="Simulting-lattice-gas-cellular-automata&quot;-1"></a><a class="docs-heading-anchor-permalink" href="#Simulting-lattice-gas-cellular-automata&quot;" title="Permalink"></a></h1><h2 id="Cellular-automata"><a class="docs-heading-anchor" href="#Cellular-automata">Cellular automata</a><a id="Cellular-automata-1"></a><a class="docs-heading-anchor-permalink" href="#Cellular-automata" title="Permalink"></a></h2><ul><li>A descretized space and time,</li><li>A state defined on the space,</li><li>A simple set of rules (local &amp; finite) to describe the evolution of the state.</li></ul><p>Reference:</p><ul><li>Hardy J, Pomeau Y, De Pazzis O. Time evolution of a two‐dimensional model system. I. Invariant states and time correlation functions[J]. Journal of Mathematical Physics, 1973, 14(12): 1746-1759.</li></ul><p><img src="https://upload.wikimedia.org/wikipedia/commons/e/ef/HppModelExamples.jpg" alt/></p><ul><li>Particles exist only on the grid points, never on the edges or surface of the lattice.</li><li>Each particle has an associated direction (from one grid point to another immediately adjacent grid point).</li><li>Each lattice grid cell can only contain a maximum of one particle for each direction, i.e., contain a total of between zero and four particles.</li></ul><p>The following rules also govern the model:</p><ul><li>A single particle moves in a fixed direction until it experiences a collision.</li><li>Two particles experiencing a head-on collision are deflected perpendicularly.</li><li>Two particles experience a collision which isn&#39;t head-on simply pass through each other and continue in the same direction.</li><li>Optionally, when a particles collides with the edges of a lattice it can rebound.</li></ul><h1 id="CUDA-programming-with-Julia"><a class="docs-heading-anchor" href="#CUDA-programming-with-Julia">CUDA programming with Julia</a><a id="CUDA-programming-with-Julia-1"></a><a class="docs-heading-anchor-permalink" href="#CUDA-programming-with-Julia" title="Permalink"></a></h1><p>CUDA programming is a parallel computing platform and programming model developed by NVIDIA for performing general-purpose computations on its GPUs (Graphics Processing Units). CUDA stands for Compute Unified Device Architecture.</p><p>References:</p><ol><li><a href="https://github.com/JuliaComputing/Training">JuliaComputing/Training</a></li><li><a href="https://arxiv.org/abs/1712.03112">arXiv: 1712.03112</a></li></ol><h2 id="Goal"><a class="docs-heading-anchor" href="#Goal">Goal</a><a id="Goal-1"></a><a class="docs-heading-anchor-permalink" href="#Goal" title="Permalink"></a></h2><ol><li>Run a CUDA program</li><li>Write your own CUDA kernel</li><li>Create a CUDA project</li></ol><h2 id="Run-a-CUDA-program&quot;"><a class="docs-heading-anchor" href="#Run-a-CUDA-program&quot;">Run a CUDA program&quot;</a><a id="Run-a-CUDA-program&quot;-1"></a><a class="docs-heading-anchor-permalink" href="#Run-a-CUDA-program&quot;" title="Permalink"></a></h2><ol><li>Make sure you have a NVIDIA GPU device and its driver is properly installed.</li></ol><p>run(<code>nvidia-smi</code>)</p><ol><li>Install the <a href="https://github.com/JuliaGPU/CUDA.jl">CUDA.jl</a> package, and disable scalar indexing of CUDA arrays.</li></ol><p>CUDA.jl provides wrappers for several CUDA libraries that are part of the CUDA toolkit:</p><ul><li>Driver library: manage the device, launch kernels, etc.</li><li>CUBLAS: linear algebra</li><li>CURAND: random number generation</li><li>CUFFT: fast fourier transform</li><li>CUSPARSE: sparse arrays</li><li>CUSOLVER: decompositions &amp; linear systems</li></ul><p>There&#39;s also support for a couple of libraries that aren&#39;t part of the CUDA toolkit, but are commonly used:</p><ul><li>CUDNN: deep neural networks</li><li>CUTENSOR: linear algebra with tensors</li></ul><p>CUDA.versioninfo()</p><ol><li>Choose a device (if multiple devices are available).</li></ol><p>devices()</p><p>dev = CuDevice(0)</p><p>grid &gt; block &gt; thread&quot;</p><p>attribute(dev, CUDA.DEVICE<em>ATTRIBUTE</em>MAX<em>THREADS</em>PER_BLOCK)</p><p>attribute(dev, CUDA.CU<em>DEVICE</em>ATTRIBUTE<em>MAX</em>BLOCK<em>DIM</em>X)</p><p>attribute(dev, CUDA.CU<em>DEVICE</em>ATTRIBUTE<em>MAX</em>GRID<em>DIM</em>X)</p><ol><li>Create a CUDA Array&quot;</li></ol><p>CUDA.zeros(10)</p><p>cuarray1 = CUDA.randn(10)</p><p>@test_throws ErrorException cuarray1[3]</p><p>CUDA.@allowscalar cuarray1[3] += 10</p><p>Upload a CPU Array to GPU&quot;</p><p>CuArray(randn(10))</p><ol><li>Compute&quot;</li></ol><p>Computing a function on GPU Arrays</p><ol><li>Launch a CUDA job - a few micro seconds</li><li>Launch more CUDA jobs...</li><li>Synchronize threads - a few micro seconds</li></ol><p>Computing matrix multiplication.&quot;</p><p>@elapsed rand(2000,2000) * rand(2000,2000)</p><p>@elapsed CUDA.@sync CUDA.rand(2000,2000) * CUDA.rand(2000,2000)</p><p>Broadcasting a native Julia function Julia -&gt; LLVM (optimized for CUDA) -&gt; CUDA &quot;</p><p>factorial(n) = n == 1 ? 1 : factorial(n-1)*n</p><h1 id="this-function-is-copied-from-lecture-9"><a class="docs-heading-anchor" href="#this-function-is-copied-from-lecture-9">this function is copied from lecture 9</a><a id="this-function-is-copied-from-lecture-9-1"></a><a class="docs-heading-anchor-permalink" href="#this-function-is-copied-from-lecture-9" title="Permalink"></a></h1><p>function poor_besselj(ν::Int, z::T; atol=eps(T)) where T     k = 0     s = (z/2)^ν / factorial(ν)     out = s::T     while abs(s) &gt; atol         k += 1         s *= -(k+ν) * (z/2)^2 / k         out += s     end     out end</p><p>x = CUDA.CuArray(0.0:0.01:10)</p><p>poor_besselj.(1, x)</p><ol><li>manage your GPU devices&quot;</li></ol><p>nvml<em>dev = NVML.Device(parent</em>uuid(device()))</p><p>NVML.power<em>usage(nvml</em>dev)</p><p>NVML.utilization<em>rates(nvml</em>dev)</p><p>NVML.compute<em>processes(nvml</em>dev)</p><h2 id="CUDA-libraries-and-Kernel-Programming"><a class="docs-heading-anchor" href="#CUDA-libraries-and-Kernel-Programming">CUDA libraries and Kernel Programming</a><a id="CUDA-libraries-and-Kernel-Programming-1"></a><a class="docs-heading-anchor-permalink" href="#CUDA-libraries-and-Kernel-Programming" title="Permalink"></a></h2><h1 id="Appendix:-The-Navier-Stokes-equation"><a class="docs-heading-anchor" href="#Appendix:-The-Navier-Stokes-equation">Appendix: The Navier-Stokes equation</a><a id="Appendix:-The-Navier-Stokes-equation-1"></a><a class="docs-heading-anchor-permalink" href="#Appendix:-The-Navier-Stokes-equation" title="Permalink"></a></h1><p>Reference: <a href="https://youtu.be/Ra7aQlenTb8">https://youtu.be/Ra7aQlenTb8</a></p><p>html &lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/Ra7aQlenTb8&quot; title=&quot;YouTube video player&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share&quot; allowfullscreen&gt;&lt;/iframe&gt;</p><p>The navier stokes equation describes the fluid dynamics, which contains the following two parts.</p><p>The first one describes the conservation of volume</p><p class="math-container">\[\nabla \underbrace{u}_{\text{velocity } u \in \mathbb{R}^d} = 0\]</p><p>The second one describes the dynamics</p><p class="math-container">\[\underbrace{\rho}_{\text{density}} \frac{du}{dt} = \underbrace{-\nabla p}_{\text{pressure}} + \underbrace{\mu \nabla^2 u}_{\text{viscosity (or friction)}} + \underbrace{f}_{\text{external force}}.\]</p></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.0 on <span class="colophon-date" title="Monday 29 April 2024 02:57">Monday 29 April 2024</span>. Using Julia version 1.10.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
