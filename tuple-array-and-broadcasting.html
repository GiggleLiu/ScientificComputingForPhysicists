<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Yu-Sheng Zhao" />
  <meta name="author" content="Yi-Dai Zhang" />
  <meta name="author" content="Jin-Guo Liu" />
  <title>Tuple, Array and broadcasting - Scientific Computing for Physicist</title>
  <link rel="shortcut icon" type="image/png" href="/favicon.png"/>
  <link rel="stylesheet" href="/style.css"/>
    <script src="/mousetrap.min.js"></script>
    <style>
  @font-face {
    font-family: JuliaMono-Regular;
    src: url("/JuliaMono-Regular.woff2");
  }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
  <link rel="stylesheet" href="/github.min.css">
<script src="/highlight.min.js"></script>
<script src="/julia.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', (event) => {
    document.querySelectorAll('pre').forEach((el) => {
        if (!el.classList.contains('output')) {
            hljs.highlightElement(el);
        }
    });
});
</script>
 
</head>
<body>
<script>
function click_next() {
  var next = document.getElementById('nav-next');
  next.firstElementChild.nextElementSibling.click();
}
function click_prev() {
  var prev = document.getElementById('nav-prev');
  prev.firstElementChild.click();
}
Mousetrap.bind('right', click_next);
Mousetrap.bind('h', click_prev);
Mousetrap.bind('left', click_prev);
Mousetrap.bind('l', click_next);
</script>

<div class="books-container">
<aside class="books-menu">
<input type="checkbox" id="menu">
<label for="menu">☰</label>
<div class="books-title">
<a href="/">Scientific Computing for Physicist</a>
</div><br />
<span class="books-subtitle">
with Julia programming language
</span>
<div class="books-menu-content">
<li><a class="menu-level-1" href="/open-source-dev-toolchains"><b>1</b> Becoming an Open-Source De..</a></li>
<li><a class="menu-level-2" href="/terminal"><b>1.1</b> Get a Terminal!</a></li>
<li><a class="menu-level-2" href="/version-control"><b>1.2</b> Maintainability - Versio..</a></li>
<li><a class="menu-level-2" href="/ci-cd"><b>1.3</b> Correctness - Unit Tests</a></li>
<li><a class="menu-level-1" href="/julia"><b>2</b> Julia</a></li>
<li><a class="menu-level-2" href="/setup"><b>2.1</b> Setup Julia</a></li>
<li><a class="menu-level-2" href="/whyjulia"><b>2.2</b> Why Julia is fast?</a></li>
<li><a class="menu-level-2" href="/type-and-multiple-dispatch"><b>2.3</b> Type and Multiple-dispat..</a></li>
<li><a class="menu-level-2" href="/tuple-array-and-broadcasting"><b>2.4</b> Tuple, Array and broadca..</a></li>
<li><a class="menu-level-2" href="/publishing-package"><b>2.5</b> Publishing a Package</a></li>
<li><a class="menu-level-1" href="/appendix"><b></b> Appendix</a></li>
<li><a class="menu-level-1" href="/references"><b>3</b> References</a></li>
</div>
</aside>

<div class="books-content">
<h2 data-number="2.4" id="tuple-array-and-broadcasting"><span class="header-section-number">2.4</span> Tuple, Array and broadcasting</h2>
<p><strong>Tuple has fixed memory layout, but array does not.</strong></p>
<pre class="language-julia"><code>tp = (1, 2.0, &#39;c&#39;)</code></pre>
<pre class="output"><code>(1, 2.0, &#39;c&#39;)</code></pre>
<pre class="language-julia"><code>typeof(tp)</code></pre>
<pre class="output"><code>Tuple{Int64, Float64, Char}</code></pre>
<pre class="language-julia"><code>isbitstype(typeof(tp))</code></pre>
<p>true</p>
<pre class="language-julia"><code>arr = [1, 2.0, &#39;c&#39;]</code></pre>
<p>1</p>
<p>2.0</p>
<pre class="output"><code>&#39;c&#39;: ASCII/Unicode U+0063 (category Ll: Letter, lowercase)</code></pre>
<pre class="language-julia"><code>typeof(arr)</code></pre>
<pre class="output"><code>Vector{Any} (alias for Array{Any, 1})</code></pre>
<pre class="language-julia"><code>isbitstype(typeof(arr))</code></pre>
<p>false</p>
<p><strong>Boardcasting</strong></p>
<pre class="language-julia"><code>x = 0:0.1:π</code></pre>
<pre class="language-julia"><code>y = sin.(x)</code></pre>
<pre class="language-julia"><code>using Plots</code></pre>
<pre class="language-julia"><code>plot(x, y; label=&quot;sin&quot;)</code></pre>
<pre class="language-julia"><code>mesh = (1:100)&#39;</code></pre>
<p><strong>Broadcasting over non-concrete element types may be type unstable.</strong></p>
<pre class="language-julia"><code>eltype(arr)</code></pre>
<pre class="output"><code>Any</code></pre>
<pre class="language-julia"><code>arr .+ 1</code></pre>
<p>2</p>
<p>3.0</p>
<pre class="output"><code>&#39;d&#39;: ASCII/Unicode U+0064 (category Ll: Letter, lowercase)</code></pre>
<pre class="language-julia"><code>eltype(tp)</code></pre>
<pre class="output"><code>Any</code></pre>
<h3 data-number="2.4.1" id="julia-package-development"><span class="header-section-number">2.4.1</span> Julia package development</h3>
<pre class="language-julia"><code>using TropicalNumbers</code></pre>
<pre class="output"><code>nothing</code></pre>
<p>The file structure of a package</p>
<pre class="language-julia"><code>project_folder = dirname(dirname(pathof(TropicalNumbers)))</code></pre>
<p>/home/runner/.julia/packages/TropicalNumbers/kRhOl</p>
<p><img src="./assets/images/julia_dev.png" alt="image" width="500" height="auto"></p>
<p><strong>Unit Test</strong></p>
<pre class="language-julia"><code>using Test</code></pre>
<pre class="output"><code>nothing</code></pre>
<pre class="language-julia"><code>@test Tropical(3.0) + Tropical(2.0) == Tropical(3.0)</code></pre>
<pre class="output"><code>Test Passed</code></pre>
<pre class="language-julia"><code>@test_throws BoundsError [1,2][3]</code></pre>
<pre class="output"><code>Test Passed
      Thrown: BoundsError</code></pre>
<pre class="language-julia"><code>@test_broken 3 == 2</code></pre>
<pre class="output"><code>Test Broken
  Expression: 3 == 2</code></pre>
<pre class="language-julia"><code>@testset &quot;Tropical Number addition&quot; begin
    @test Tropical(3.0) + Tropical(2.0) == Tropical(3.0)
    @test_throws BoundsError [1][2]
    @test_broken 3 == 2
end</code></pre>
<pre class="output"><code>Test.DefaultTestSet(&quot;Tropical Number addition&quot;, Any[Test Broken
  Expression: 3 == 2], 2, false, false, true, 1.707316862782449e9, 1.707316862807562e9, false, &quot;none&quot;)</code></pre>
<h3 data-number="2.4.2" id="case-study-create-a-package-like-happymolecules"><span class="header-section-number">2.4.2</span> Case study: Create a package like HappyMolecules</h3>
<p>With <code>PkgTemplates</code>.</p>
<p><a href="https://github.com/CodingThrust/HappyMolecules.jl">https://github.com/CodingThrust/HappyMolecules.jl</a></p>
<pre class="julia"><code>julia&gt; isbitstype(Complex{Float64})

julia&gt; sizeof(Complex{Float32})

julia&gt; sizeof(Complex{Float64})</code></pre>
<p>But <code>Complex{BigFloat}</code> is not</p>
<pre class="julia"><code>julia&gt; sizeof(Complex{BigFloat})

julia&gt; isbitstype(Complex{BigFloat})</code></pre>
<p>The size of <code>Complex{BigFloat}</code> is not true! It returns the pointer size!</p>
<h3 data-number="2.4.3" id="how-to-measure-the-performance-of-your-cpu"><span class="header-section-number">2.4.3</span> How to measure the performance of your CPU?</h3>
<p>The performance of a CPU is measured by the number of <strong>floating point operations per second</strong> (FLOPS) it can perform. The floating point operations include addition, subtraction, multiplication and division. The FLOPS can be related to multiple factors, such as the clock frequency, the number of cores, the number of instructions per cycle, and the number of floating point units. A simple way to measure the FLOPS is to benchmarking the speed of matrix multiplication.</p>
<pre class="julia"><code>julia&gt; using BenchmarkTools

julia&gt; A, B = rand(1000, 1000), rand(1000, 1000);

julia&gt; @btime $A * $B;
  12.122 ms (2 allocations: 7.63 MiB)</code></pre>
<p>The number of FLOPS in a <span class="math inline">\(n\times n\times n\)</span> matrix multiplication is <span class="math inline">\(2n^3\)</span>. The FLOPS can be calculated as: <span class="math inline">\(2 \times 1000^3 / (12.122 \times 10^{-3}) = 165~{\rm GFLOPS}\)</span>.</p>
<h3 data-number="2.4.4" id="case-study-vector-element-type-and-speed"><span class="header-section-number">2.4.4</span> Case study: Vector element type and speed</h3>
<p>Any type vector is flexible. You can add any element into it.</p>
<pre class="julia"><code>vany = Any[]  # same as vany = []

typeof(vany)

push!(vany, &quot;a&quot;)

push!(vany, 1)</code></pre>
<p>Fixed typed vector is more restrictive.</p>
<pre class="julia"><code>vfloat64 = Float64[]

vfloat64 |&gt; typeof

push!(vfloat64, &quot;a&quot;)</code></pre>
<p>Do not abuse the type system. e.g. a “zero” cost implementation</p>
<pre class="julia"><code>Val(3.0) # just a type

f(::Val{1}) = Val(1)

f(::Val{2}) = Val(1)</code></pre>
<p>It violates the <a href="https://docs.julialang.org/en/v1/manual/performance-tips/">Performance Tips</a>, since it transfers the run-time to compile time.</p>
<pre class="julia"><code>let biganyv = collect(Any, 1:2:20000)
    @benchmark for i=1:length($biganyv)
        $biganyv[i] += 1
    end
end</code></pre>
<pre class="julia"><code>let bigfloatv = collect(Float64, 1:2:20000)
    @benchmark for i=1:length($bigfloatv)
        $bigfloatv[i] += 1
    end
end</code></pre>
<pre class="julia"><code>fib(x::Int) = x &lt;= 2 ? 1 : fib(x-1) + fib(x-2)

@benchmark fib(20)</code></pre>
<pre class="julia"><code>addup(::Val{x}, ::Val{y}) where {x, y} = Val(x + y)</code></pre>
<pre class="julia"><code>f(::Val{x}) where x = addup(f(Val(x-1)), f(Val(x-2)))</code></pre>
<pre class="julia"><code>@benchmark f(Val(20)) end</code></pre>


<div class="bottom-nav">
    <p id="nav-prev" style="text-align: left;">
        <a class="menu-level-2" href="/type-and-multiple-dispatch"><b>2.3</b> Type and Multiple-dispat..</a> <kbd>←</kbd>
        <span id="nav-next" style="float: right;">
            <kbd>→</kbd> <a class="menu-level-2" href="/publishing-package"><b>2.5</b> Publishing a Package</a>
        </span>
    </p>
</div>


<div class="license">
    <br/>
  <br/>
  <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a>
    Yu-Sheng Zhao, Yi-Dai Zhang, Jin-Guo Liu
</div>
</div>
</div>
</body>
</html>